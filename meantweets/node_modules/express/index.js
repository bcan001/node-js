module.exports = require('./lib/express');

var express = require('express');
var cookieParser = require('cookie-parser');
var bodyParser = require('body-parser');
var session = require('express-session');
var passport = require('passport');
// Initialize models
require('./models/models');
// passes in the passport functino when using authenticate method
var authenticate = require('./routes/authenticate')(passport);
// every request to /posts will start with api ... so the request will be to /api/posts
var api = require('./routes/api');

var mongoose = require('mongoose');
// connect to mongo db
mongoose.connect('mongodb://localhost/chirp-test');


var app = express();

// middleware for the session
// The session manager uses a secret to maintain sessions. In practice, you should keep this secret value outside of your code repository in an environment variable.
app.use(session({
	secret: 'keyboard cat',
	// saveUninitialized: true,
 //  resave: true
}));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));
app.use(cookieParser());
app.use(express.static(__dirname + '/public'));

// middleware for password (start passport, then use session method)
app.use(passport.initialize());
app.use(passport.session());

// auth portion
app.use('/auth', authenticate)
// api portion
app.use('/api', api)


// Initialize passport (use passport-init.js module) (module.exports = function(passport) {...} is the same as initPassport(passport))
var initPassport = require('./passport-init');
initPassport(passport);


app.get('/', function(request, response) {
	// if you're not using a templating engine, need to manually set the path to the file:
	response.sendfile(__dirname + '/public/index.html');
});

app.listen(3000)

